<div class="form-container">
  <h5 mat-dialog-title>Future Jobs - Submit Profile</h5>
  <mat-dialog-content>
    <form [formGroup]="profileForm" class="profile-form">
      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" required />
          <mat-error>Name is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" required />
          <mat-error>Valid email is required</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Contact</mat-label>
          <input matInput formControlName="contact" required />
          <mat-error>Contact is required</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Job Skill</mat-label>
          <input matInput formControlName="jobSkill" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Current Job Role</mat-label>
          <input matInput formControlName="jobRole" />
        </mat-form-field>

        <mat-form-field class="form-field">
          <mat-label>Location</mat-label>
          <mat-select formControlName="location">
            <mat-option
              *ngFor="let location of locations"
              [value]="location.countryName"
            >
              {{ location.countryName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field class="form-field">
          <mat-label>Nationality</mat-label>
          <mat-select formControlName="nationality" multiple>
            <mat-option
              *ngFor="let location of locations"
              [value]="location.countryName"
            >
              {{ location.countryName }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Ready To Relocate</mat-label>
          <mat-select formControlName="readyToRelocate">
            <mat-option *ngFor="let period of readyToRelocate" [value]="period">
              {{ period }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field class="form-field">
          <mat-label>Native Language</mat-label>
          <mat-select formControlName="nativeLanguage">
            <mat-option
              *ngFor="let language of language"
              [value]="language.languageName"
            >
              {{ language.languageName }}
            </mat-option>
          </mat-select>
          <mat-error>Native Language is required</mat-error>
        </mat-form-field>

        <mat-form-field class="form-field">
          <mat-label>Job Language</mat-label>
          <mat-select formControlName="jobLanguage" multiple>
            <mat-option
              *ngFor="let language of language"
              [value]="language.languageName"
            >
              {{ language.languageName }}
            </mat-option>
          </mat-select>
          <mat-error>Job Language is required</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Language Level</mat-label>
          <input matInput formControlName="languageLevel" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Notice Period (Days)</mat-label>
          <input matInput formControlName="noticePeriod" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field class="form-field">
          <mat-label>Currency</mat-label>
          <mat-select formControlName="salaryCurrency">
            <mat-option
              *ngFor="let currency of currency"
              [value]="currency.currencyName"
            >
              {{ currency.currencyName }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="salary-field">
          <mat-label>Salary</mat-label>
          <input matInput formControlName="salary" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field class="form-field">
          <mat-label>Profile Fit for Client *</mat-label>
          <mat-select formControlName="profileForClient">
            <mat-option
              *ngFor="let client of filteredClients"
              [value]="client.clientName"
            >
              {{ client.clientName }}
            </mat-option>
          </mat-select>
          <mat-error>Client profile is required</mat-error>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
            <mat-form-field style="flex: 1; margin-right: 8px;">
              <mat-label>Search Client</mat-label>
              <input matInput [value]="clientSearchTerm" #clientSearch (input)="onClientSearch(clientSearch.value)" />
            </mat-form-field>
            <a [routerLink]="['/app/add-client']">Add</a>
          </div>
        </mat-form-field>

        <mat-form-field class="form-field">
          <mat-label>Proposed Job Role *</mat-label>
          <mat-select formControlName="jobOrderId" [disabled]="!profileForm.get('profileForClient')?.value || (passedData?.action === 'view')" (selectionChange)="onJobOrderChange($event.value)" required>
            <mat-option *ngIf="filteredJobOrders.length === 0 && profileForm.get('profileForClient')?.value" value="">
              No job orders available for this client
            </mat-option>
            <mat-option *ngIf="!profileForm.get('profileForClient')?.value" value="">
              Please select a client first
            </mat-option>
            <mat-option *ngFor="let jobOrder of filteredJobOrders" [value]="jobOrder.id">
              {{ jobOrder.jobId }} - {{ jobOrder.jobTitle }}
            </mat-option>
          </mat-select>
          <mat-error>Job role is required</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Current Company</mat-label>
          <input matInput formControlName="currentCompany" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Education</mat-label>
          <input matInput formControlName="education" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Total Years of Experience</mat-label>
          <input matInput formControlName="totalYearOfExp" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Profile Source</mat-label>
          <input matInput formControlName="profileSource" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Profile Source Link</mat-label>
          <input matInput formControlName="profileSourceLink" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Availability Date</mat-label>
          <input
            matInput
            [matDatepicker]="availDatePicker"
            formControlName="availabilityDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="availDatePicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #availDatePicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Recruiter Notes</mat-label>
          <textarea
            matInput
            formControlName="recruiterNotes"
            rows="2"
          ></textarea>
        </mat-form-field>

        <!-- <div class="file-upload">
          <label>
            <input
              type="file"
              (change)="onFileSelected($event)"
              accept=".pdf,.doc,.docx"
              required
            />
            Resume (PDF/DOC)
          </label>
          <mat-error
            *ngIf="
              profileForm.get('resume')?.hasError('required') &&
              profileForm.get('resume')?.touched
            "
          >
            Resume is required
          </mat-error>
        </div> -->

        <ng-container>
          <div class="attachment-field">
            <mat-form-field class="form-width">
              <mat-label>Resume *</mat-label>
              <input matInput [value]="attachmentFileName" disabled />
            </mat-form-field>
        
            <!-- Download Icon (Visible only when attachmentFileName has a value) -->
            <span
              *ngIf="attachmentFileName"
              class="download-container"
              (click)="onDownload(attachmentFileName)"
              title="Download File"
            >
              <mat-icon class="download-icon">file_download</mat-icon>
              Download File
            </span>
        
            <input
              type="file"
              (change)="onFileSelected($event)"
              accept=".pdf,.doc,.docx"
              required
            />
        
            <mat-error
              *ngIf="
                profileForm.get('resume')?.hasError('required') &&
                profileForm.get('resume')?.touched
              "
            >
              Resume is required
            </mat-error>
          </div>
        </ng-container>
        
      </div>

      <!-- <div class="form-row">

      
      </div> -->
    </form>
  </mat-dialog-content>
  <div class="actions">
    <!-- Existing buttons -->
    <button mat-button (click)="onCancel()">Cancel</button>

    <!-- New button â€“ visible only when editing -->
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit('SUBMITTED')"
      [disabled]="!profileForm.valid"
    >
      Save
    </button>

    <button
      *ngIf="isEditMode"
      mat-raised-button
      color="accent"
      (click)="onSubmit('PROPOSED')"
      [disabled]="!profileForm.valid"
    >
      Submit
    </button>
  </div>
</div>
